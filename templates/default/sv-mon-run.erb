#!/bin/sh
exec 2>&1
SVCDIR=`pwd`

# Command: /usr/bin/ceph-mon -i <%= @options['mon_id'] %> --pid-file /var/run/ceph/mon.<%= @options['mon_id'] %>.pid -c /etc/ceph/ceph.conf

# Two failure modes: transient and permanant.  Transient: scream and die (runit will restart). Permanant: call critical_failure (will not restart).

critical_failure() {
  echo ${1}
  echo "Critical Failure called, disabling service!"
  touch $SVCDIR/service/down
  exit 1
}

ulimit -n 8192

# Bring up the MON!
exec /usr/bin/ceph-mon -i <%= @options['mon_id'] %> --pid-file /var/run/ceph/mon.<%= @options['mon_id'] %>.pid -c /etc/ceph/ceph.conf -f