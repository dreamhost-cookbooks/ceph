# Generated by Chef
[global]
	auth supported = cephx
	ms bind ipv6 = true
	keyring = /etc/ceph/$name.keyring

[mon]
	mon data = /srv/ceph/mon.$id
<% node["ceph"]["config"]["mon"].each do |key, value| -%>
	<%= key %> = <%= value %>
<% end -%>

<% @mon_pool.each do |mon| -%>
[mon.<%= mon[:hostname] %>]
	host = <%= mon[:hostname] %>
	<% if (mon["network"][node["network"]["storage"]]["v6"]["addr"]["primary"].nil?) then -%>
	mon addr = <%= mon["network"][node["network"]["storage"]]["v4"]["addr"]["primary"] %>:6789
	<% else -%>
	mon addr = [<%= mon["network"][node["network"]["storage"]]["v6"]["addr"]["primary"] %>]:6789
	<% end -%>
<% end -%>

[mds]
<% node["ceph"]["config"]["mds"].each do |key, value| -%>
	<%= key %> = <%= value %>
<% end -%>

[osd]
	btrfs devs = /srv/ceph/devices/osd.$id.data
	osd journal = /srv/ceph/devices/osd.$id.journal
	keyring = /srv/ceph/osd/$id/keyring
	osd data = /srv/ceph/osd/$id
	admin socket = /var/run/ceph/ceph-$name.asok
<% node["ceph"]["config"]["osd"].each do |key, value| -%>
	<%= key %> = <%= value %>
<% end -%>

<% @osd_devices.each do |osd_device| -%>
[osd.<%= osd_device['osd_id'] %>]
	host = <%= node[:hostname] %>
	<% if (node["network"][node["network"]["storage"]]["v6"]["addr"]["primary"].nil?) then -%>
	public addr = <%= node["network"][node["network"]["storage"]]["v4"]["addr"]["primary"] %>
	<% else -%>
	public addr = [<%= node["network"][node["network"]["storage"]]["v6"]["addr"]["primary"] %>]
	<% end -%>
	<% if (! node["network"]["storage-back"].nil?) then -%>
	<%   if (node["network"][node["network"]["storage-back"]]["v6"]["addr"]["primary"].nil?) then -%>
	cluster addr = <%= node["network"][node["network"]["storage-back"]]["v4"]["addr"]["primary"] %>
	<%   else -%>
	cluster addr = [<%= node["network"][node["network"]["storage-back"]]["v6"]["addr"]["primary"] %>]
	<%   end -%>
	<% end -%>

<% end -%>

<% if ( @is_radosgw == 1 ) then -%>
[client.radosgw.<%= node[:hostname] %>]
	log file = /var/log/ceph/$id.log
	rgw socket path = /var/run/ceph/radosgw.client.radosgw.<%= node[:hostname] %>
	rgw swift url = https://<%= node["ceph"]["api_fqdn"] %>
	rgw swift url prefix = swift
	rgw dns name = <%= node["ceph"]["api_fqdn"] %>
	<% node["ceph"]["config"]["rgw"].each do |key, value| -%>
	<%= key %> = <%= value %>
<%   end -%>
<% end -%>

# This must be the last line and will be ignored
