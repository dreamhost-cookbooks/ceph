[global]
        auth supported = cephx
	ms bind ipv6 = true
        keyring = /etc/ceph/$name.keyring
        log file = /var/log/ceph/$id.log
<% if (! node["ceph"]["debug"].nil?) then -%>
        debug ms = 1
<% end -%>

[mon]
        mon data = /srv/ceph/mon.$id
	osd pool default size = 3
	osd pool default crush rule = 0
	mon osd down out interval = 600
<% if (! node["ceph"]["debug"].nil?) then -%>
<%   if (! node["ceph"]["debug"]["mon"].nil?) then -%>
        debug mon = <%= node["ceph"]["debug"]["mon"] %>
<%   end -%>
<% end -%>

<% @mon_pool.each do |mon| -%>
[mon.<%= mon[:hostname] %>]
        host = <%= mon[:hostname] %>
  <% if (mon["network"][node["network"]["storage"]]["v6"]["addr"]["primary"].nil?) then -%>
        mon addr = <%= mon["network"][node["network"]["storage"]]["v4"]["addr"]["primary"] %>:6789
  <% else -%>
        mon addr = [<%= mon["network"][node["network"]["storage"]]["v6"]["addr"]["primary"] %>]:6789
  <% end -%>

<% end -%>
[mds]
<% if (! node["ceph"]["debug"].nil?) then -%>
<%   if (! node["ceph"]["debug"]["mds"].nil?) then -%>
        debug mds = <%= node["ceph"]["debug"]["mds"] %>
<%   end -%>
<% end -%>

[osd]
        btrfs devs = /srv/ceph/devices/osd.$id.data
        osd journal = /srv/ceph/devices/osd.$id.journal
	keyring = /srv/ceph/osd/$id/keyring
        osd data = /srv/ceph/osd/$id
	filestore flusher = false
        max open files = 4096
<% if (! node["ceph"]["debug"].nil?) then -%>
<%   if (! node["ceph"]["debug"]["osd"].nil?) then -%>
        debug osd = <%= node["ceph"]["debug"]["osd"] %>
<%   end -%>
<% end -%>

<% @osd_devices.each do |osd_device| -%>
[osd.<%= osd_device['osd_id'] %>]
	host = <%= node[:hostname] %>
  <% if (node["network"][node["network"]["storage"]]["v6"]["addr"]["primary"].nil?) then -%>
	public addr = <%= node["network"][node["network"]["storage"]]["v4"]["addr"]["primary"] %>
  <% else -%>
	public addr = [<%= node["network"][node["network"]["storage"]]["v6"]["addr"]["primary"] %>]
  <% end -%>
  <% if (! node["network"]["storage-back"].nil?) then -%>
    <% if (node["network"][node["network"]["storage-back"]]["v6"]["addr"]["primary"].nil?) then -%>
        cluster addr = <%= node["network"][node["network"]["storage-back"]]["v4"]["addr"]["primary"] %>
    <% else -%>
        cluster addr = [<%= node["network"][node["network"]["storage-back"]]["v6"]["addr"]["primary"] %>]
    <% end -%>
  <% end -%>

<% end -%>

<% if ( @is_radosgw == 1 ) then -%>
[client.radosgw.<%= node[:hostname] %>]
        log file = /var/log/ceph/$id.log
	rgw socket path = /var/run/ceph/radosgw.client.radosgw.<%= node[:hostname] %>
	rgw cache enabled = 1
	rgw swift url = https://<%= node["ceph"]["api_fqdn"] %>
	rgw swift url prefix = swift
	rgw dns name = <%= node["ceph"]["api_fqdn"] %>
	rgw cache lru size = 10000
<% if (! node["ceph"]["debug"].nil?) then -%>
<%   if (! node["ceph"]["debug"]["osd"].nil?) then -%>
        debug rgw = <%= node["ceph"]["debug"]["rgw"] %>
        debug objecter = <%= node["ceph"]["debug"]["rgw"] %>
<%   end -%>
<% end -%>
<% end %>

# This must be the last line and will be ignored
