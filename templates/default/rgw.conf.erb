# Generated by Chef
FastCgiExternalServer /var/www/dummyradosgw.fcgi -socket /var/run/ceph/radosgw.client.radosgw.<%= node[:hostname] %>

LogFormat "%{X-Forwarded-For}i %{Host}i %u %t \"%r\" %>s %B %I \"%{Referer}i\" \"%{User-Agent}i\" %D" proxy_combined
LogFormat "%{X-Forwarded-For}i %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" proxy_debug

<VirtualHost <%= @listen_addr %>:80>
  ServerName <%= node[:ceph][:api_fqdn] %>
  ServerAdmin <%= node[:ceph][:admin_email] %>
  DocumentRoot /var/www/

  RewriteEngine On
  RewriteRule             ^/(.*) /dummyradosgw.fcgi?params=$1&%{QUERY_STRING} [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]
  <IfModule mod_fastcgi.c>
    <Directory /var/www/>
      Options +ExecCGI
      AllowOverride All
      SetHandler fastcgi-script
      Order allow,deny
      Allow from all
      AuthBasicAuthoritative Off
    </Directory>
  </IfModule>

  SetEnv RGW_DNS_NAME "<%= node[:ceph][:api_fqdn] %>"
  SetEnv RGW_LOG_LEVEL 20
  SetEnv RGW_PRINT_CONTINUE "yes"
  SetEnv RGW_OPENSTACK_URL "http://<%= node[:ceph][:api_fqdn] %>"
  SetEnv RGW_OPENSTACK_URL_PREFIX "swift"
  SetEnv RGW_REMOTE_ADDR_PARAM "X-Forwarded-For"

  SetEnv CEPH_ARGS "-n client.radosgw-<%= node[:hostname] %>"
  SetEnv RGW_SHOULD_LOG "yes"

  AllowEncodedSlashes On

  ErrorLog /var/log/apache2/error.log
  CustomLog /var/log/apache2/sssrgw-access.log proxy_combined
  ServerSignature Off
</VirtualHost>
